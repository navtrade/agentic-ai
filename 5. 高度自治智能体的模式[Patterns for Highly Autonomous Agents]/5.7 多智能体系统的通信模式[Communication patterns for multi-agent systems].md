## 多代理系统的协作模式（ **Communication patterns for multi-agent systems** ）

当一个团队一起工作时，他们之间的沟通模式可能会非常复杂。类似地，设计多智能体系统的通信模式也同样复杂，而组织结构的好坏会极大影响系统的效率与结果。

本节我们会基于上面一节里的市场调研Agent，介绍四种协作模式：线性、双层、多层和去中心。

---

1. **线性模式（Linear communication pattern）**

就像一个市场团队的工作流：研究员 → 平面设计师 → 文案撰写者。每个人只和下一个环节沟通。

线性模式按顺序执行任务，信息单向流动；

* 优点：结构简单、易于理解；
* 缺点：不灵活，出错时难以反馈或修正。

---

2. **双层模式（Hierarchical communication pattern）**

有一个“管理员（Manager Agent）”负责协调所有下属Agent。
就像项目负责人依次给研究员、设计师、写手分配任务，收集结果，再整合。

![](..\images\5.7.1.png)

双层模式下，所有通信都经过经理；

* **优点** ：清晰、易于控制、任务协调性强；
* **缺点** ：可能成为瓶颈（manager负担重）。

---

3. **多层模式（Deep Hierarchy）**

一些高级系统会让子Agent自己也拥有下属Agent。
 例如“研究员”下面有“网页研究员”和“事实核查员”，“作家”下面有“风格写手”和“引用校对员”。

![](..\images\5.7.2.png)

* 优点：可扩展、模块化、可分层调度；
* 缺点：通信复杂、难以调试、出错难追踪。

---

4. **去中心模式（All-to-all communication）**

在这种模式下，每个Agent都能随时与其他Agent交流，没有中心，也没有固定顺序。

每个Agent都知道其他Agent是谁，他们可以互相发消息，谁都可以决定何时回复。直到最后大家都“认为任务完成”时，产出最终结果。

![](..\images\5.7.3.png)

特点：高度去中心化、非常灵活、创意性强，但也 难以预测结果。

这种模式适用于容忍一定混乱、追求创造性结果的场景。

---

我们将这四种通信模式总结为下表：

| 模式类型               | 结构特征           | 优点     | 缺点     | 适用场景           |
| ---------------------- | ------------------ | -------- | -------- | ------------------ |
| 线性（Linear）         | 顺序执行，单向通信 | 简单     | 不灵活   | 固定流程任务       |
| 双层（Hierarchical）   | 中心协调           | 易控制   | 管理负担 | 多任务协调         |
| 多层（Deep Hierarchy） | 子Agent层次化      | 模块化   | 复杂     | 大型系统           |
| 去中心（All-to-all）   | 自由对话           | 创造性强 | 不可预测 | 探索型、生成型任务 |

> 实际生产中，线性模式与双层模式会更常用一些，因为至少对于当前LLM的能力而言，信息会在层级之间传递时丢失部分信息，层级越多，信息越匮乏/失真。
>
> 其实在这四种模式外，还有一种对话模式，比较类似去中心模式的降级版。对话模式每次都只有两个Agent互相对话交流，一方执行任务，另一方审查任务，最终交出一份双方都满意的结果。
>
> 在常见的Agent框架中，langchain是忠实的线性结构，smolagents更青睐于双层/多层结构，而metagpt、camelai则致力于做去中心结构。当然，大部分框架都可以同时实现这些不同的结构，只是代码风格不同，读者可以自行多尝试，找到自己最喜欢的框架，与最适合某项具体任务的框架。

